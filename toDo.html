<!DOCTYPE html>
<html>

<head>

</head>

<body>

    <input type="text" id="textBox">
    <input type="date" id="date-picker">
    <button onclick="addToDo()">add to do</button>
    <div id="todo-list"></div>
    <script>
        //model
        let todos;
        savedToDos = JSON.parse(localStorage.getItem("todo"));
        if (Array.isArray(savedToDos)) {
            todos = savedToDos;
        } else {
            todos = [
                {
                    title: "go to the gym",
                    dueDate: "2022-04-16",
                    id: "id1",
                    isDone: true,
                    isEditing: undefined
                },
                {
                    title: "study JS",
                    dueDate: "2022-04-17",
                    id: "id2",
                    isDone: false,
                    isEditing: undefined
                },
                {
                    title: "study python",
                    dueDate: "2022-04-15",
                    id: "id3",
                    isDone: false,
                    isEditing: undefined
                }];
        }

        loadingToDo();

        function createToDo(title, dueDate) {
            const id = "" + new Date().getTime();
            todos.push({
                title: title,
                dueDate: dueDate,
                id: id,
                isDone: false,
                isEditing: undefined
            });
            saveToDo();
        }
        function removeToDo(idToDelete) {
            todos = todos.filter(function (element) {
                if (idToDelete === element.id) {
                    return false;
                } else {
                    return true;
                }
            });
            saveToDo();
        }
        function setIsDone(idCheckbox) {
            todos.forEach(function (element) {
                if (idCheckbox === element.id) {
                    element.isDone = !element.isDone;
                }
            });
            saveToDo();
        }
        function setEditProperty(idEditButton) {
            todos.forEach(function(element){
                if(element.id==idEditButton){
                    renderEditableToDo();
                }
            });
        }
        function saveToDo() {
            localStorage.setItem("todo", JSON.stringify(todos));
        }

        //view
        function loadingToDo() {
            document.getElementById("todo-list").innerHTML = '';

            todos.forEach(function (todo) {

                const element = document.createElement('div');

                element.innerText = todo.title + " " + todo.dueDate;

                const checkbox = document.createElement("input");
                checkbox.setAttribute("type", "checkbox");
                checkbox.dataset.todoId = todo.id;
                checkbox.onclick = checkToDo;
                if (todo.isDone) {
                    checkbox.checked = true;
                }

                const editButton = document.createElement("button");
                editButton.innerText = "Edit";
                editButton.id = todo.id;
                editButton.style = "margin-left:12px";
                editButton.onclick = editToDo;

                const deleteButton = document.createElement("button");
                deleteButton.innerText = "Delete"
                deleteButton.style = "margin-left:12px";
                deleteButton.id = todo.id;
                deleteButton.onclick = deleteToDo;

                element.appendChild(checkbox);
                element.appendChild(editButton);
                element.appendChild(deleteButton);

                const todoList = document.getElementById("todo-list");
                todoList.appendChild(element);
            });
        }

        function renderEditableToDo(){
            // Here change the elements for edit from the specific toDo
        }

        //controller
        function deleteToDo(event) {

            const deleteButton = event.target;
            const idToDelete = deleteButton.id;
            removeToDo(idToDelete);
            loadingToDo();
        }

        function addToDo() {
            let textBox = document.getElementById('textBox');
            let title = textBox.value;
            let datePicker = document.getElementById("date-picker");
            let dueDate = datePicker.value;
            createToDo(title, dueDate);
            loadingToDo();
        }

        function checkToDo(event) {
            const checkbox = event.target;
            const idCheckbox = checkbox.dataset.todoId;
            setIsDone(idCheckbox);
        }

        function editToDo(event) {
            const editButton = event.target;
            const idEditButton = editButton.id;
            setEditProperty(idEditButton);
        }

    </script>
</body>

</html>